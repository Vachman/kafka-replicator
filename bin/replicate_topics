#!/usr/bin/env ruby

require "bundler/setup"
require "kafka_replicator"
require "json"

# You can add fixtures and/or initialization code here to make experimenting
# with your gem easier. You can also use a different console, if you like.

# (If you use this, don't forget to add pry to your Gemfile!)
# require "pry"
# Pry.start

source_brokers = JSON.parse(ENV['KAFKA_REPLICATOR_SOURCE_BROKERS'])
raise "KAFKA_REPLICATOR_SOURCE_BROKERS environment variable is not set" unless source_brokers

destination_brokers = JSON.parse(ENV['KAFKA_REPLICATOR_DESTINATION_BROKERS'])
raise "KAFKA_REPLICATOR_DESTINATION_BROKERS environment variable is not set" unless destination_brokers

puts "Replicating from #{source_brokers} to #{destination_brokers}"

KafkaReplicator::TopicsReplicator.new(
  source_brokers: source_brokers, 
  destination_brokers: destination_brokers
).start
